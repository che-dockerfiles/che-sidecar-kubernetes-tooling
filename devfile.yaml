apiVersion: 1.0.0

metadata:
  name: kubernetes-tooling-dev

projects:
  - name: che-sidecar-kubernetes-tooling
    source:
      location: 'https://github.com/che-dockerfiles/che-sidecar-kubernetes-tooling'
      # location: 'https://github.com/vitaliy-guliy/che-sidecar-kubernetes-tooling'
      type: git
      branch: master
      # branch: dev

  - name: vscode-kubernetes-tools
    source:
      location: 'https://github.com/Azure/vscode-kubernetes-tools'
      type: git
      branch: master

components:
  - type: cheEditor
    id: eclipse/che-theia/7.10.0
    memoryLimit: 1500M

  - type: dockerimage
    image: 'quay.io/eclipse/che-sidecar-kubernetes-tooling:1.1.0-31a8464'
    alias: buildah-dev
    mountSources: true
    memoryLimit: 3Gi
    env:
      - name: PLUGIN_REMOTE_ENDPOINT_EXECUTABLE
        value: 'tail -f /dev/null'

commands:

  - name: '1. Login to quay.io'
    actions:
      - workdir: /projects/che-sidecar-kubernetes-tooling
        type: exec
        command: |
          if [ ! -f "dev/login.sh" ]; then \
            mkdir -p dev; \
            curl -o dev/login.sh https://raw.githubusercontent.com/vitaliy-guliy/che-sidecar-kubernetes-tooling/dev/dev/login.sh; \
            chmod +x dev/login.sh; \
          fi; \
          dev/login.sh
        component: buildah-dev

  - name: '2. Build the image'
    actions:
      - workdir: /projects/che-sidecar-kubernetes-tooling
        type: exec
        command: |
          if [ ! -f "dev/build.sh" ]; then \
            mkdir -p dev; \
            curl -o dev/build.sh https://raw.githubusercontent.com/vitaliy-guliy/che-sidecar-kubernetes-tooling/dev/dev/build.sh; \
            chmod +x dev/build.sh; \
          fi; \
          pwd; \
          dev/build.sh        
        component: buildah-dev

  - name: '3. Push to quay.io'
    actions:
      - workdir: /projects/che-sidecar-kubernetes-tooling
        type: exec
        command: |
          if [ ! -f "dev/push.sh" ]; then \
            mkdir -p dev; \
            curl -o dev/push.sh https://raw.githubusercontent.com/vitaliy-guliy/che-sidecar-kubernetes-tooling/dev/dev/push.sh; \
            chmod +x dev/push.sh; \
          fi; \
          pwd; \
          dev/push.sh
        component: buildah-dev

  - name: '4. Publish plugin.meta.yaml'
    actions:
      - workdir: /projects/che-sidecar-kubernetes-tooling
        type: exec
        command: |
          if [ ! -f "dev/publish.meta.yaml.sh" ]; then \
            mkdir -p dev; \
            curl -o dev/publish.meta.yaml.sh https://raw.githubusercontent.com/vitaliy-guliy/che-sidecar-kubernetes-tooling/dev/dev/publish.meta.yaml.sh; \
            chmod +x dev/publish.meta.yaml.sh; \
          fi; \
          pwd; \
          dev/publish.meta.yaml.sh
        component: buildah-dev

  - name: '5. Publish devfile.yaml'
    actions:
      - workdir: /projects/che-sidecar-kubernetes-tooling
        type: exec
        command: |
          if [ ! -f "dev/publish.devfile.sh" ]; then \
            mkdir -p dev; \
            curl -o dev/publish.devfile.sh https://raw.githubusercontent.com/vitaliy-guliy/che-sidecar-kubernetes-tooling/dev/dev/publish.devfile.sh; \
            chmod +x dev/publish.devfile.sh; \
          fi; \
          pwd; \
          dev/publish.devfile.sh
        component: buildah-dev

